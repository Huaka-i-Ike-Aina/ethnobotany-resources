---

output: html_document

---

# A note on dependencies

+ Leaflet requires installing external dependencies
  + See https://rspatial.github.io/terra/


```{r, include = FALSE}

packages <- c("rvest", "xml2", "dplyr", "purrr", "stringr",
              "rmarkdown", "knitr", "xml2", "data.table", "httr",
              "leaflet", "geojsonsf", "jsonlite", "sf", "geojsonio")

install_if_missing <- function(pkg) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    install.packages(pkg)
  }
}

invisible(lapply(packages, install_if_missing))
invisible(lapply(packages, library, character.only = TRUE))

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

```
	

# Simple Leaflet Map
```{r leaf-map}

# Create a leaflet map widget
leaflet() %>%
  # Add default OpenStreetMap tiles to the map
  addTiles() %>%
  # Set the initial view of the map
  setView(lng = -157.858333, lat = 21.306944, zoom = 10) %>%
  # Add a marker for a specific location (Honolulu)
  addMarkers(lng = -157.858333, lat = 21.306944, popup = "Aloha from Honolulu! ðŸŒº")

```

# Leaflet Ahupuaa Map with details
```{r leaf-ahupuaa-map}


# Read GeoJSON as sf object
ahupuaa_data <- st_read("data/Ahupuaa.geojson")
raingauge_data <- st_read("data/Rain_Gauges.geojson")

# Calculate centroids for labeling
centroids <- st_centroid(ahupuaa_data)

# Create map
map <- leaflet() %>%
  addTiles() %>%
  setView(lng = -157.8583, lat = 20.9078, zoom = 7)

# Add ahupuaa polygons
map <- map %>%
  addPolygons(
    data = ahupuaa_data,
    label = ~ahupuaa,
    group = "Ahupuaa",
    labelOptions = labelOptions(noHide = FALSE, textOnly = TRUE, direction = "center", offset = c(0,0), style = list("color" = "darkgreen", "font-weight" = "bold", "font-size" = "12px")),  
    fillColor = "lightblue",
    fillOpacity = 0.3,
    color = "navy",
    weight = 2,
  )

# Add markers at centroids
map <- map %>%
  addMarkers(
    data = centroids,
    popup = ~paste0(
      "<h3>", ahupuaa, "</h3>",
      "<p><strong>Moku:</strong> ", moku, "</p>",
      "<p><strong>Mokupuni:</strong> ", mokupuni, "</p>",
      "<p><strong>Area:</strong> ", gisacres, " ac</p>"
    ),
    label = ~ahupuaa,
    clusterOptions = markerClusterOptions()
  )
map

```
