<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="scraping-bm-eb">Scraping BM-EB</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Install required packages only if missing ---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Define the URL ---</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=list&amp;o=1&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Read the HTML content ---</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Extract all &lt;table&gt; elements ---</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Check how many tables are found ---</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(tables)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Convert the first table to a data frame ---</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>ethno_table <span class="ot">&lt;-</span> tables[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Preview the data ---</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ethno_table)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 145</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 3</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ `Hawaiian Name`   &lt;chr&gt; &quot;‘a‘ali‘i&quot;, &quot;a‘e (Sapindus)&quot;, &quot;a‘e (Z…</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ `Scientific Name` &lt;chr&gt; &quot;Dodonaea viscosa&quot;, &quot;Sapindus saponar…</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ `Vernacular Name` &lt;chr&gt; &quot;none&quot;, &quot;soapberry&quot;, &quot;none&quot;, &quot;none&quot;, …</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: View first rows</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ethno_table)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `Hawaiian Name`   `Scientific Name`       `Vernacular Name`</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;                   &lt;chr&gt;            </span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ‘a‘ali‘i          Dodonaea viscosa        none             </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a‘e (Sapindus)    Sapindus saponaria      soapberry        </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 a‘e (Zanthoxylem) Zanthoxylum (4 species) none             </span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 ‘ahakea           Bobea (4 species)       none             </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ‘āheahea          Chenopodium oahuense    none             </span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 ‘ahu‘awa          Cyperus javanicus       sedge</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Create &#39;data&#39; directory if it doesn&#39;t exist ---</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;data&quot;</span>)) {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Save the table as CSV in the &#39;data&#39; directory ---</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(ethno_table, <span class="at">file =</span> <span class="st">&quot;data/ethno_table.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<h2 id="display-bm-eb-table">Display BM EB Table</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bmeb <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/ethno_table.csv&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(bmeb, <span class="at">caption =</span> <span class="st">&quot;Ethnobotany plants in Bishop Museum&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Hawaiian.Name</th>
<th align="left">Scientific.Name</th>
<th align="left">Vernacular.Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">’a‘ali‘i</td>
<td align="left">Dodonaea viscosa</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">a‘e (Sapindus)</td>
<td align="left">Sapindus saponaria</td>
<td align="left">soapberry</td>
</tr>
<tr class="odd">
<td align="left">a‘e (Zanthoxylem)</td>
<td align="left">Zanthoxylum (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ahakea</td>
<td align="left">Bobea (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’āheahea</td>
<td align="left">Chenopodium oahuense</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ahu‘awa</td>
<td align="left">Cyperus javanicus</td>
<td align="left">sedge</td>
</tr>
<tr class="odd">
<td align="left">aiea</td>
<td align="left">Nothocestrum (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’aka‘akai</td>
<td align="left">Schoenoplectus lacustris</td>
<td align="left">great bulrush</td>
</tr>
<tr class="odd">
<td align="left">’ākala</td>
<td align="left">Rubus (2 species)</td>
<td align="left">Hawaiian raspberry</td>
</tr>
<tr class="even">
<td align="left">’ākia</td>
<td align="left">Wikstroemia (12 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’akoko</td>
<td align="left">Chamaesyce (16 species)</td>
<td align="left">spurge</td>
</tr>
<tr class="even">
<td align="left">’aākōlea</td>
<td align="left">Athyrium microphyllum</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ākulikuli</td>
<td align="left">Sesuvium portulacastrum</td>
<td align="left">sea purslane</td>
</tr>
<tr class="even">
<td align="left">’āla‘a</td>
<td align="left">Pouteria sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ala‘ala wai nui</td>
<td align="left">Peperomia (24 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">alahe‘e</td>
<td align="left">Psydrax odorata</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">alani</td>
<td align="left">Melicope (47 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">ali‘ipoe</td>
<td align="left">Canna indica</td>
<td align="left">Indian-shot</td>
</tr>
<tr class="odd">
<td align="left">aloalo</td>
<td align="left">Hibiscus (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ama‘u</td>
<td align="left">Sadleria cyatheoides</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ape</td>
<td align="left">Alocasia macrorrhizos</td>
<td align="left">elephant’s ear</td>
</tr>
<tr class="even">
<td align="left">’auhuhu</td>
<td align="left">Tephrosia purpurea</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’awa</td>
<td align="left">Piper methysticum</td>
<td align="left">kava</td>
</tr>
<tr class="even">
<td align="left">’awapuhi</td>
<td align="left">Zingiber zerumbet</td>
<td align="left">shampoo ginger, wild ginger</td>
</tr>
<tr class="odd">
<td align="left">’āwikiwiki</td>
<td align="left">Canavalia (6 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">hala</td>
<td align="left">Pandanus tectorius</td>
<td align="left">screw pine</td>
</tr>
<tr class="odd">
<td align="left">hala pepe</td>
<td align="left">Pleomele (6 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">hame</td>
<td align="left">Antidesma (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">hao</td>
<td align="left">Rauvolfia sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">hāpu‘u</td>
<td align="left">Cibotium (2 species)</td>
<td align="left">tree fern</td>
</tr>
<tr class="odd">
<td align="left">hau</td>
<td align="left">Hibiscus tiliaceus</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">hinahina</td>
<td align="left">Heliotropium anomalum var. argentea</td>
<td align="left">heliotrope</td>
</tr>
<tr class="odd">
<td align="left">hō‘awa</td>
<td align="left">Pittosporum (11 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">hoi</td>
<td align="left">Dioscorea bulbifera</td>
<td align="left">bitter yam, air potato</td>
</tr>
<tr class="odd">
<td align="left">hōlei</td>
<td align="left">Ochrosia (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ie‘ie</td>
<td align="left">Freycinetia arborea</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’iliahi</td>
<td align="left">Santalum (4 species)</td>
<td align="left">sandalwood</td>
</tr>
<tr class="even">
<td align="left">’ilie‘e</td>
<td align="left">Plumbago zeylanica</td>
<td align="left">leadwort</td>
</tr>
<tr class="odd">
<td align="left">’ilima</td>
<td align="left">Sida fallax</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">ipu</td>
<td align="left">Lagenaria siceraria</td>
<td align="left">bottle gourd</td>
</tr>
<tr class="odd">
<td align="left">kalia</td>
<td align="left">Elaeocarpus bifidus</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kalo</td>
<td align="left">Colocasia esculenta</td>
<td align="left">taro</td>
</tr>
<tr class="odd">
<td align="left">kamani</td>
<td align="left">Calophyllum inophyllum</td>
<td align="left">Alexandrian laurel</td>
</tr>
<tr class="even">
<td align="left">kauila (Alphitonia)</td>
<td align="left">Alphitonia ponderosa</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kauila (Colubrina)</td>
<td align="left">Colubrina oppositifolia</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kauna‘oa</td>
<td align="left">Cuscuta sandwichiana</td>
<td align="left">dodder</td>
</tr>
<tr class="odd">
<td align="left">kāwa‘u</td>
<td align="left">Ilex anomala</td>
<td align="left">Hawaiian holly</td>
</tr>
<tr class="even">
<td align="left">kāwelu</td>
<td align="left">Eragrostis variabilis</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kī</td>
<td align="left">Cordyline fruticosa</td>
<td align="left">ti</td>
</tr>
<tr class="even">
<td align="left">kī nehe</td>
<td align="left">Bidens pilosa</td>
<td align="left">Spanish needle, beggartick</td>
</tr>
<tr class="odd">
<td align="left">kō</td>
<td align="left">Saccharum officinarum</td>
<td align="left">sugarcane</td>
</tr>
<tr class="even">
<td align="left">koa</td>
<td align="left">Acacia koa</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">koai‘a</td>
<td align="left">Acacia koaia</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">koali ’ai</td>
<td align="left">Ipomoea cairica</td>
<td align="left">ivy-leaved morning glory</td>
</tr>
<tr class="odd">
<td align="left">koali ’awa</td>
<td align="left">Ipomoea indica</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kohekohe</td>
<td align="left">Eleocharis (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">koki‘o</td>
<td align="left">Kokia &amp; Hibiscus (5 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">koki‘o ke‘oke‘o</td>
<td align="left">Hibiscus arnottianus</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kōlea</td>
<td align="left">Myrsine (20 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kolokolo kuahiwi</td>
<td align="left">Lysimachia (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kolomona</td>
<td align="left">Senna gaudichaudii</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">ko‘oko‘olau</td>
<td align="left">Bidens (19 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kōpiko</td>
<td align="left">Psychotria (11 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kou</td>
<td align="left">Cordia subcordata</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">kūkaenēnē,</td>
<td align="left">Coprosma ernodeides</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">kūkaepua‘a</td>
<td align="left">Digitaria setigera</td>
<td align="left">itchy crabgrass</td>
</tr>
<tr class="odd">
<td align="left">kukui</td>
<td align="left">Aleurites moluccana</td>
<td align="left">candlenut, tung tree</td>
</tr>
<tr class="even">
<td align="left">kupukupu</td>
<td align="left">Nephrolepis cordifolia</td>
<td align="left">sword fern</td>
</tr>
<tr class="odd">
<td align="left">la‘amia</td>
<td align="left">Cresentia cujete</td>
<td align="left">calabash tree</td>
</tr>
<tr class="even">
<td align="left">lama</td>
<td align="left">Diospyros (2 species)</td>
<td align="left">persimmon, ebony</td>
</tr>
<tr class="odd">
<td align="left">laua‘e</td>
<td align="left">Phymatosorus grossus</td>
<td align="left">maile-scented fern</td>
</tr>
<tr class="even">
<td align="left">laukahi kuahiwi</td>
<td align="left">Plantago (3 species)</td>
<td align="left">plantain</td>
</tr>
<tr class="odd">
<td align="left">lehua papa</td>
<td align="left">Metrosideros rugosa</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">loulu</td>
<td align="left">Pritchardia (22 species)</td>
<td align="left">native fan palm</td>
</tr>
<tr class="odd">
<td align="left">ma‘aloa</td>
<td align="left">Neraudia melastomifolia</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">mai‘a</td>
<td align="left">Musa x paradisiaca</td>
<td align="left">banana</td>
</tr>
<tr class="odd">
<td align="left">mai‘a hē‘ī</td>
<td align="left">Musa troglodytarum</td>
<td align="left">banana (Tahiti)</td>
</tr>
<tr class="even">
<td align="left">maile</td>
<td align="left">Alyxia stellata</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">makaloa</td>
<td align="left">Cyperus laevigatus</td>
<td align="left">umbrella sedge</td>
</tr>
<tr class="even">
<td align="left">māmaki</td>
<td align="left">Pipturus (4 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">māmane,</td>
<td align="left">Sophora chrysophylla</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">manono</td>
<td align="left">Kadua (3 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">ma‘o (Abutilon)</td>
<td align="left">Abutilon incanum</td>
<td align="left">hoary abutilon</td>
</tr>
<tr class="even">
<td align="left">ma‘o (Gossypium)</td>
<td align="left">Gossypium tomentosum</td>
<td align="left">Hawaiian cotton</td>
</tr>
<tr class="odd">
<td align="left">maua</td>
<td align="left">Xylosma hawaiiense</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">mau‘u lāili</td>
<td align="left">Sisyrinchium acre</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">mēhamehame</td>
<td align="left">Flueggea neowawraea</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">milo</td>
<td align="left">Thespesia populnea</td>
<td align="left">portia tree</td>
</tr>
<tr class="odd">
<td align="left">moa</td>
<td align="left">Psilotum nudum</td>
<td align="left">upright whisk fern</td>
</tr>
<tr class="even">
<td align="left">mokihana</td>
<td align="left">Melicope anisata</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">na‘ena‘e</td>
<td align="left">Dubautia (24 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">naio</td>
<td align="left">Myoporum sandwicense</td>
<td align="left">false sandalwood, bastard sandalwood</td>
</tr>
<tr class="odd">
<td align="left">nānū</td>
<td align="left">Gardenia (3 species)</td>
<td align="left">Hawaiian gardenia</td>
</tr>
<tr class="even">
<td align="left">naupaka kahakai</td>
<td align="left">Scaevola taccada</td>
<td align="left">beach naupaka</td>
</tr>
<tr class="odd">
<td align="left">naupaka kuahiwi</td>
<td align="left">Scaevola (9 species)</td>
<td align="left">dwarf naupaka (S. coriacea</td>
</tr>
<tr class="even">
<td align="left">nehe</td>
<td align="left">Lipochaeta &amp; Melanthera (20 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">nīoi</td>
<td align="left">Eugenia (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">niu</td>
<td align="left">Cocos nucifera</td>
<td align="left">coconut</td>
</tr>
<tr class="odd">
<td align="left">noni</td>
<td align="left">Morinda citrifolia</td>
<td align="left">Indian mulberry</td>
</tr>
<tr class="even">
<td align="left">nuku ’i‘iwi</td>
<td align="left">Strongylodon ruber</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ohai</td>
<td align="left">Sesbania tomentosa</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ōhā wai</td>
<td align="left">Clermontia (22 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ohe</td>
<td align="left">Schizostachyum glaucifolium</td>
<td align="left">native bamboo, Polynesian bamboo</td>
</tr>
<tr class="even">
<td align="left">’ōhelo</td>
<td align="left">Vaccinium (3 species)</td>
<td align="left">blueberry</td>
</tr>
<tr class="odd">
<td align="left">’ohe makai</td>
<td align="left">Reynoldsia sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ohe ’ohe</td>
<td align="left">Tetraplasandra (8 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ōhi‘a ’ai</td>
<td align="left">Syzygium malaccense</td>
<td align="left">mountain apple, Malay apple</td>
</tr>
<tr class="even">
<td align="left">’ōhi‘a hā</td>
<td align="left">Syzygium sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ōhi‘a lehua</td>
<td align="left">Metrosideros (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ōkaha</td>
<td align="left">Asplenium nidus</td>
<td align="left">bird’s nest fern</td>
</tr>
<tr class="odd">
<td align="left">’ōlapa</td>
<td align="left">Cheirodendron (5 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ōolena</td>
<td align="left">Curcuma longa</td>
<td align="left">turmeric</td>
</tr>
<tr class="odd">
<td align="left">olomea</td>
<td align="left">Perrottetia sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">olonā</td>
<td align="left">Touchardia latifolia</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">olopua</td>
<td align="left">Nestegis sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">ūpuhe</td>
<td align="left">Urera (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">pā‘ihi</td>
<td align="left">Rorippa sarmentosa</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">pa‘iniu</td>
<td align="left">Astelia (3 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">pala</td>
<td align="left">Marattia douglasii</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">pala‘ā</td>
<td align="left">Sphenomeris chinensis</td>
<td align="left">lace fern</td>
</tr>
<tr class="odd">
<td align="left">palapalai</td>
<td align="left">Microlepia strigosa</td>
<td align="left">lace fern</td>
</tr>
<tr class="even">
<td align="left">pāmoho</td>
<td align="left">Nephrolepis exaltata subsp. hawaiiensis</td>
<td align="left">sword fern</td>
</tr>
<tr class="odd">
<td align="left">pāpala</td>
<td align="left">Charpetiera (5 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">pāpala kōpau</td>
<td align="left">Pisonia (5 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">pi‘ia</td>
<td align="left">Dioscorea pentaphylla</td>
<td align="left">pi‘a Hawai‘i, wild yam</td>
</tr>
<tr class="even">
<td align="left">pia or arrowroot</td>
<td align="left">Tacca leontopetaloides</td>
<td align="left">Polynesian arrowroot</td>
</tr>
<tr class="odd">
<td align="left">pili</td>
<td align="left">Heteropogon contortus</td>
<td align="left">tanglehead, twisted beardgrass, pili grass</td>
</tr>
<tr class="even">
<td align="left">pilo</td>
<td align="left">Coprosma (12 species)</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">pōhinahina</td>
<td align="left">Vitex rotundifolia</td>
<td align="left">beach vitex</td>
</tr>
<tr class="even">
<td align="left">pōhuehue</td>
<td align="left">Ipomoea pes-caprae</td>
<td align="left">beach morning glory</td>
</tr>
<tr class="odd">
<td align="left">pōpolo</td>
<td align="left">Solanum americanum</td>
<td align="left">glossy nightshade</td>
</tr>
<tr class="even">
<td align="left">pōpolo kū mai</td>
<td align="left">Phytolacca sandwicensis</td>
<td align="left">pokeberry, pokeweed</td>
</tr>
<tr class="odd">
<td align="left">pua kala</td>
<td align="left">Argemone glauca</td>
<td align="left">prickly poppy</td>
</tr>
<tr class="even">
<td align="left">pūkiawe</td>
<td align="left">Leptecophylla tameiameiae</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’uala</td>
<td align="left">Ipomoea batatas</td>
<td align="left">sweet potato</td>
</tr>
<tr class="even">
<td align="left">’uhaloa</td>
<td align="left">Waltheria indica</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">uhi</td>
<td align="left">Dioscorea alata</td>
<td align="left">yam</td>
</tr>
<tr class="even">
<td align="left">uhiuhi</td>
<td align="left">Caesalpinia kavaiensis</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’uki</td>
<td align="left">Machaerina (2 species)</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’uki‘uki</td>
<td align="left">Dianella sandwicensis</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">’ūlei</td>
<td align="left">Osteomeles anthyllidifolia</td>
<td align="left">none</td>
</tr>
<tr class="even">
<td align="left">’ulu</td>
<td align="left">Artocarpus altilis</td>
<td align="left">breadfruit</td>
</tr>
<tr class="odd">
<td align="left">uluhe</td>
<td align="left">Dicranopteris linearis</td>
<td align="left">false staghorn fern</td>
</tr>
<tr class="even">
<td align="left">wauke</td>
<td align="left">Broussonetia papyrifera</td>
<td align="left">paper mulberry</td>
</tr>
<tr class="odd">
<td align="left">wiliwili</td>
<td align="left">Erythrina sandwicensis</td>
<td align="left">none</td>
</tr>
</tbody>
</table>
<p>Ethnobotany plants in Bishop Museum</p>
<h1 id="webcrawler">Webcrawler</h1>
<p>Coded with assistance from ChatGPT.</p>
<p>Currently should have the following functionality:</p>
<ul>
<li>Scrapes all pages with pagination,</li>
<li>Pulls all depth-2 details,</li>
<li>Normalizes them into a single <code>data.table</code>,</li>
<li>Polite throttling included, and</li>
<li>Can resume if interrupted.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Base URL (pagination placeholder)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>base_url_template <span class="ot">&lt;-</span> <span class="st">&quot;https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=list&amp;o=%d&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Output files for resume</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>depth1_file <span class="ot">&lt;-</span> <span class="st">&quot;data/ethnobotany_depth1_progress.csv&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>final_file  <span class="ot">&lt;-</span> <span class="st">&quot;data/ethnobotany_full_normalized.csv&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ---- Step 1: Load existing depth-1 data if resuming ----</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(depth1_file)) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    depth1_dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(depth1_file)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Resuming with &quot;</span>, <span class="fu">nrow</span>(depth1_dt), <span class="st">&quot; depth-1 rows already scraped.&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    depth1_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Resuming with 27260 depth-1 rows already scraped.</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ---- Step 2: Scrape depth-1 pages ----</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>scrape_depth1_page <span class="ot">&lt;-</span> <span class="cf">function</span>(page_number) {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(base_url_template, page_number)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Scraping depth-1 page: &quot;</span>, url)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    page <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">read_html</span>(url), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">return</span>(<span class="cn">NULL</span>))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(page)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    tbl_node <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span> <span class="fu">html_node</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(tbl_node) <span class="sc">||</span> <span class="fu">length</span>(tbl_node) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    main_table <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(main_table) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(main_table)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setnames</span>(dt, <span class="fu">make.names</span>(<span class="fu">names</span>(dt), <span class="at">unique =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Hawaiian Name links</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    hawaiian_nodes <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_nodes</span>(<span class="st">&quot;table tr td:nth-child(1) a&quot;</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    hawaiian_links <span class="ot">&lt;-</span> hawaiian_nodes <span class="sc">%&gt;%</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">url_absolute</span>(url)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    dt[, Detail_URL <span class="sc">:</span><span class="er">=</span> hawaiian_links]</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>))  <span class="co"># polite random pause</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(dt)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># If no depth-1 data yet, start scraping from page 1</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(depth1_dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    all_depth1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    page_number <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">repeat</span> {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> <span class="fu">scrape_depth1_page</span>(page_number)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(dt)) <span class="cf">break</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        all_depth1[[<span class="fu">length</span>(all_depth1) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> dt</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        depth1_dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_depth1, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fwrite</span>(depth1_dt, depth1_file)  <span class="co"># save progress</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        page_number <span class="ot">&lt;-</span> page_number <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ---- Step 3: Scrape depth-2 detail pages ----</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>scrape_detail_page <span class="ot">&lt;-</span> <span class="cf">function</span>(url) {</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;   Depth-2: &quot;</span>, url)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    page <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">read_html</span>(url), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">return</span>(<span class="cn">NULL</span>))</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(page)) <span class="fu">return</span>(<span class="fu">list</span>())</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    detail_tables <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(detail_tables) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">list</span>())</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    detail_df <span class="ot">&lt;-</span> detail_tables[[<span class="dv">1</span>]]</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">ncol</span>(detail_df) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        labels <span class="ot">&lt;-</span> <span class="fu">str_trim</span>(detail_df[[<span class="dv">1</span>]])</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        values <span class="ot">&lt;-</span> <span class="fu">str_trim</span>(detail_df[[<span class="dv">2</span>]])</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(values) <span class="ot">&lt;-</span> <span class="fu">make.names</span>(labels, <span class="at">unique =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        values <span class="ot">&lt;-</span> <span class="fu">as.list</span>(values)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        values <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>))  <span class="co"># polite random pause</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(values)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ---- Step 4: Resume-aware depth-2 scraping ----</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(final_file)) {</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    final_dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(final_file)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    scraped_urls <span class="ot">&lt;-</span> <span class="fu">unique</span>(final_dt<span class="sc">$</span>Detail_URL)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    final_dt <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    scraped_urls <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Filter only URLs we haven&#39;t scraped yet</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>pending_urls <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(depth1_dt<span class="sc">$</span>Detail_URL, scraped_urls)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Depth-2 pages remaining: &quot;</span>, <span class="fu">length</span>(pending_urls))</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Depth-2 pages remaining: 0</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Scrape only pending detail pages</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>detail_list <span class="ot">&lt;-</span> <span class="fu">map</span>(pending_urls, scrape_detail_page)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Convert to data.table</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>details_dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(detail_list, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Match them back to depth1 rows</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> depth1_dt[Detail_URL <span class="sc">%in%</span> pending_urls]</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>final_batch <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_data, details_dt)</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Append to final dataset</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(final_dt)) {</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    final_dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(final_dt, final_batch), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    final_dt <span class="ot">&lt;-</span> final_batch</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Save progress</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(final_dt, final_file)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Prep final_dt for depth 2 crawling</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(final_dt)[<span class="fu">grepl</span>(<span class="st">&quot;URL&quot;</span>, <span class="fu">colnames</span>(final_dt))] <span class="ot">&lt;-</span> <span class="st">&quot;URL&quot;</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>final_dt[[<span class="st">&quot;depth&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">dim</span>(final_dt)[<span class="dv">1</span>])</span></code></pre></div>
<h1 id="depth-2-crawler">Depth 2 Crawler</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Text helpers</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>clean_txt <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;\u00A0&quot;</span>, <span class="st">&quot; &quot;</span>, x)          <span class="co"># NBSP -&gt; space</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, x)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_squish</span>(x)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>esc_re <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">&quot;([][{}()+*^$|?.</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\\\</span><span class="st">])&quot;</span>, <span class="st">&quot;</span><span class="sc">\\\\\\</span><span class="st">1&quot;</span>, x)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Canonical label mapping (extend as needed)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>canon_label <span class="ot">&lt;-</span> <span class="cf">function</span>(label) {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">clean_txt</span>(<span class="fu">gsub</span>(<span class="st">&quot;[:]+</span><span class="sc">\\</span><span class="st">s*$&quot;</span>, <span class="st">&quot;&quot;</span>, label)))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  patterns <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Hawaiian Name(s)&quot;</span> <span class="ot">=</span> <span class="st">&quot;^hawaiian</span><span class="sc">\\</span><span class="st">s+name(s)?$&quot;</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Scientific Name&quot;</span>  <span class="ot">=</span> <span class="st">&quot;^scientific</span><span class="sc">\\</span><span class="st">s+name$|^species$|^binomial$|^taxon$&quot;</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vernacular Name&quot;</span>  <span class="ot">=</span> <span class="st">&quot;^vernacular</span><span class="sc">\\</span><span class="st">s+name(s)?$|^common</span><span class="sc">\\</span><span class="st">s+name(s)?$|^english</span><span class="sc">\\</span><span class="st">s+name(s)?$&quot;</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Family&quot;</span>           <span class="ot">=</span> <span class="st">&quot;^family$&quot;</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Status&quot;</span>           <span class="ot">=</span> <span class="st">&quot;^status$|^native</span><span class="sc">\\</span><span class="st">s*status$|^endemic( status)?$&quot;</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Part Used&quot;</span>        <span class="ot">=</span> <span class="st">&quot;^part(s)?</span><span class="sc">\\</span><span class="st">s+used$&quot;</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Uses&quot;</span>             <span class="ot">=</span> <span class="st">&quot;^use(s)?$|^traditional</span><span class="sc">\\</span><span class="st">s+use(s)?$|^uses(/|</span><span class="sc">\\</span><span class="st">s+)practices$&quot;</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Medicinal&quot;</span>        <span class="ot">=</span> <span class="st">&quot;^medicinal$|^medicine$&quot;</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Habitat&quot;</span>          <span class="ot">=</span> <span class="st">&quot;^habitat$&quot;</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Distribution&quot;</span>     <span class="ot">=</span> <span class="st">&quot;^distribution$|^location(s)?$|^island(s)?$&quot;</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;References&quot;</span>       <span class="ot">=</span> <span class="st">&quot;^reference(s)?$|^sources?$&quot;</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Notes&quot;</span>            <span class="ot">=</span> <span class="st">&quot;^note(s)?$|^remarks$&quot;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">names</span>(patterns)) <span class="cf">if</span> (<span class="fu">grepl</span>(patterns[[k]], L, <span class="at">perl =</span> <span class="cn">TRUE</span>)) <span class="fu">return</span>(k)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fallback: keep original label (trimmed)</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub</span>(<span class="st">&quot;:</span><span class="sc">\\</span><span class="st">s*$&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">clean_txt</span>(label))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract label/value pairs from a content node</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>extract_fields <span class="ot">&lt;-</span> <span class="cf">function</span>(content_node) {</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  fields <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  addf <span class="ot">&lt;-</span> <span class="cf">function</span>(label, value) {</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    lbl <span class="ot">&lt;-</span> <span class="fu">canon_label</span>(label)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> <span class="fu">clean_txt</span>(value)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(lbl) <span class="sc">||</span> <span class="sc">!</span><span class="fu">nzchar</span>(val)) <span class="fu">return</span>(<span class="fu">invisible</span>())</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(fields[[lbl]])) fields[[lbl]] <span class="ot">&lt;-</span> val</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> fields[[lbl]] <span class="ot">&lt;-</span> <span class="fu">paste</span>(fields[[lbl]], val, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Definition lists: &lt;dt&gt;Label&lt;/dt&gt;&lt;dd&gt;Value&lt;/dd&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (dl <span class="cf">in</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(content_node, <span class="st">&quot;dl&quot;</span>)) {</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    dts <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(dl, <span class="st">&quot;dt&quot;</span>); dds <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(dl, <span class="st">&quot;dd&quot;</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">length</span>(dts), <span class="fu">length</span>(dds))</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) <span class="fu">addf</span>(rvest<span class="sc">::</span><span class="fu">html_text2</span>(dts[[i]]), rvest<span class="sc">::</span><span class="fu">html_text2</span>(dds[[i]]))</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Tables: assume first cell is label, rest are value</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tbl <span class="cf">in</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(content_node, <span class="st">&quot;table&quot;</span>)) {</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (tr <span class="cf">in</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(tbl, <span class="st">&quot;tr&quot;</span>)) {</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      cells <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(tr, <span class="st">&quot;th, td&quot;</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(cells) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        label <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_text2</span>(cells[[<span class="dv">1</span>]])</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        vals <span class="ot">&lt;-</span> <span class="fu">vapply</span>(cells[<span class="sc">-</span><span class="dv">1</span>], rvest<span class="sc">::</span>html_text2, <span class="st">&quot;&quot;</span>, <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        vals <span class="ot">&lt;-</span> vals[<span class="fu">nzchar</span>(vals)]</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">length</span>(vals)) <span class="fu">addf</span>(label, <span class="fu">paste</span>(vals, <span class="at">collapse =</span> <span class="st">&quot; | &quot;</span>))</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Bold/strong label at start of paragraph/list item</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (parent <span class="cf">in</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(content_node, <span class="st">&quot;p, li&quot;</span>)) {</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_element</span>(parent, <span class="st">&quot;strong, b&quot;</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(b, <span class="st">&quot;xml_missing&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(b) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      label <span class="ot">&lt;-</span> <span class="fu">clean_txt</span>(rvest<span class="sc">::</span><span class="fu">html_text2</span>(b))</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>      par_txt <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_text2</span>(parent)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nzchar</span>(label) <span class="sc">&amp;&amp;</span> <span class="fu">nzchar</span>(par_txt)) {</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">s*&quot;</span>, <span class="fu">esc_re</span>(label), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s*:?</span><span class="sc">\\</span><span class="st">s*&quot;</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        value <span class="ot">&lt;-</span> <span class="fu">clean_txt</span>(<span class="fu">sub</span>(pattern, <span class="st">&quot;&quot;</span>, par_txt, <span class="at">perl =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nzchar</span>(value)) <span class="fu">addf</span>(label, value)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) Plain &quot;Label: Value&quot; lines (no bold)</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  known_left <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Hawaiian Name&quot;</span>, <span class="st">&quot;Hawaiian Name(s)&quot;</span>, <span class="st">&quot;Scientific Name&quot;</span>, <span class="st">&quot;Vernacular Name&quot;</span>,</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Common Name&quot;</span>, <span class="st">&quot;English Name&quot;</span>, <span class="st">&quot;Family&quot;</span>, <span class="st">&quot;Status&quot;</span>, <span class="st">&quot;Part Used&quot;</span>, <span class="st">&quot;Uses&quot;</span>,</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Medicinal&quot;</span>, <span class="st">&quot;Habitat&quot;</span>, <span class="st">&quot;Distribution&quot;</span>, <span class="st">&quot;References&quot;</span>, <span class="st">&quot;Notes&quot;</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  left_re <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">s*(&quot;</span>, <span class="fu">paste</span>(<span class="fu">unique</span>(known_left), <span class="at">collapse=</span><span class="st">&quot;|&quot;</span>), <span class="st">&quot;)</span><span class="sc">\\</span><span class="st">s*:</span><span class="sc">\\</span><span class="st">s*(.+)$&quot;</span>)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (node <span class="cf">in</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(content_node, <span class="st">&quot;p, li, div&quot;</span>)) {</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    txt <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_text2</span>(node)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(txt)) <span class="cf">next</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">regexec</span>(left_re, txt, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    rr <span class="ot">&lt;-</span> <span class="fu">regmatches</span>(txt, m)[[<span class="dv">1</span>]]</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(rr) <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="fu">addf</span>(rr[<span class="dv">2</span>], rr[<span class="dv">3</span>])</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  fields</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose content container</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>choose_content_node <span class="ot">&lt;-</span> <span class="cf">function</span>(doc, <span class="at">selectors =</span> <span class="fu">c</span>(<span class="st">&quot;#content&quot;</span>,<span class="st">&quot;div#content&quot;</span>,<span class="st">&quot;#main&quot;</span>,<span class="st">&quot;main&quot;</span>,<span class="st">&quot;article&quot;</span>,<span class="st">&quot;.content&quot;</span>,<span class="st">&quot;#mw-content-text&quot;</span>,<span class="st">&quot;body&quot;</span>)) {</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sel <span class="cf">in</span> selectors) {</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    node <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_element</span>(doc, sel)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(node, <span class="st">&quot;xml_missing&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(node) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">return</span>(node)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_element</span>(doc, <span class="st">&quot;body&quot;</span>)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape one URL -&gt; one-row data.table (wide)</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>scrape_one <span class="ot">&lt;-</span> <span class="cf">function</span>(url,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ua =</span> <span class="st">&quot;ethnobotany-resources/0.1 (+https://github.com/stacyllyn/ethnobotany-resources)&quot;</span>,</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>                       <span class="at">timeout_sec =</span> <span class="dv">30</span>) {</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  safe_row <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">error =</span> <span class="cn">NA_character_</span>, <span class="at">status =</span> <span class="cn">NA_integer_</span>, <span class="at">title =</span> <span class="cn">NA_character_</span>) {</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">url =</span> url, <span class="at">page_title =</span> title, <span class="at">status =</span> status,</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>               <span class="at">fetched_at =</span> <span class="fu">Sys.time</span>(), <span class="at">error =</span> error)</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(httr<span class="sc">::</span><span class="fu">GET</span>(url, httr<span class="sc">::</span><span class="fu">user_agent</span>(ua), httr<span class="sc">::</span><span class="fu">timeout</span>(timeout_sec)), <span class="at">error =</span> identity)</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(resp, <span class="st">&quot;error&quot;</span>)) <span class="fu">return</span>(<span class="fu">safe_row</span>(<span class="fu">paste</span>(<span class="st">&quot;request_error:&quot;</span>, resp<span class="sc">$</span>message)))</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  status <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">status_code</span>(resp)</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (status <span class="sc">&gt;=</span> <span class="dv">400</span>) <span class="fu">return</span>(<span class="fu">safe_row</span>(<span class="fu">paste</span>(<span class="st">&quot;http_status&quot;</span>, status), <span class="at">status =</span> status))</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>  html_txt <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(httr<span class="sc">::</span><span class="fu">content</span>(resp, <span class="at">as =</span> <span class="st">&quot;text&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>), <span class="at">error =</span> identity)</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(html_txt, <span class="st">&quot;error&quot;</span>) <span class="sc">||</span> <span class="sc">!</span><span class="fu">nzchar</span>(html_txt)) <span class="fu">return</span>(<span class="fu">safe_row</span>(<span class="st">&quot;empty_response&quot;</span>, <span class="at">status =</span> status))</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>  doc <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(xml2<span class="sc">::</span><span class="fu">read_html</span>(html_txt), <span class="at">error =</span> identity)</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(doc, <span class="st">&quot;error&quot;</span>)) <span class="fu">return</span>(<span class="fu">safe_row</span>(<span class="st">&quot;parse_error&quot;</span>, <span class="at">status =</span> status))</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>  title_node <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_element</span>(doc, <span class="st">&quot;title&quot;</span>)</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>  page_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">inherits</span>(title_node, <span class="st">&quot;xml_missing&quot;</span>)) <span class="cn">NA_character_</span> <span class="cf">else</span> <span class="fu">clean_txt</span>(rvest<span class="sc">::</span><span class="fu">html_text2</span>(title_node))</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>  content_node <span class="ot">&lt;-</span> <span class="fu">choose_content_node</span>(doc)</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(content_node, <span class="st">&quot;xml_missing&quot;</span>) <span class="sc">||</span> <span class="fu">length</span>(content_node) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">safe_row</span>(<span class="st">&quot;content_not_found&quot;</span>, <span class="at">status =</span> status, <span class="at">title =</span> page_title))</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>  fields <span class="ot">&lt;-</span> <span class="fu">extract_fields</span>(content_node)</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">url =</span> url, <span class="at">page_title =</span> page_title, <span class="at">status =</span> status,</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>               <span class="at">fetched_at =</span> <span class="fu">Sys.time</span>(), <span class="at">error =</span> <span class="cn">NA_character_</span>),</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.table</span>(<span class="fu">as.list</span>(fields), <span class="at">keep.rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape many URLs</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>scrape_many <span class="ot">&lt;-</span> <span class="cf">function</span>(urls, <span class="at">sleep_bounds =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>)) {</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(urls)) <span class="fu">return</span>(<span class="fu">data.table</span>())</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fu">length</span>(urls), <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(urls))</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(urls)) {</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, sleep_bounds[<span class="dv">1</span>], sleep_bounds[<span class="dv">2</span>]))  <span class="co"># polite delay</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>    res[[i]] <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">scrape_one</span>(urls[[i]]), <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.table</span>(<span class="at">url =</span> urls[[i]], <span class="at">page_title =</span> <span class="cn">NA_character_</span>, <span class="at">status =</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fetched_at =</span> <span class="fu">Sys.time</span>(), <span class="at">error =</span> <span class="fu">paste</span>(<span class="st">&quot;unexpected_error:&quot;</span>, e<span class="sc">$</span>message))</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setTxtProgressBar</span>(pb, i)</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(pb)</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">rbindlist</span>(res, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">use.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional diagnostics: peek at first-column labels inside common containers for one URL</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="st">&quot;https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=aalii&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(u)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#content&quot;</span>,<span class="st">&quot;div#content&quot;</span>,<span class="st">&quot;#main&quot;</span>,<span class="st">&quot;main&quot;</span>,<span class="st">&quot;article&quot;</span>,<span class="st">&quot;.content&quot;</span>,<span class="st">&quot;#mw-content-text&quot;</span>,<span class="st">&quot;body&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>diag <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sels, <span class="cf">function</span>(s) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  node <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_element</span>(doc, s)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(node, <span class="st">&quot;xml_missing&quot;</span>) <span class="sc">||</span> <span class="fu">length</span>(node) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(node, <span class="st">&quot;tr&quot;</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(rows)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  labs <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(rows, <span class="cf">function</span>(tr) {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    cells <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_elements</span>(tr, <span class="st">&quot;th, td&quot;</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(cells) <span class="sc">&gt;=</span> <span class="dv">1</span>) rvest<span class="sc">::</span><span class="fu">html_text2</span>(cells[[<span class="dv">1</span>]]) <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(<span class="at">selector =</span> s, <span class="at">first_col_labels =</span> <span class="fu">unique</span>(<span class="fu">na.omit</span>(stringr<span class="sc">::</span><span class="fu">str_squish</span>(labs))))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">Filter</span>(<span class="fu">Negate</span>(is.null), diag)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes you&#39;ve already run:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - setup_deps (packages)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - functions chunk (defines clean_txt, canon_label, extract_fields, scrape_one, scrape_many)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">&quot;final_dt&quot;</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>url_col   <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(final_dt), <span class="fu">c</span>(<span class="st">&quot;url&quot;</span>,<span class="st">&quot;URL&quot;</span>,<span class="st">&quot;link&quot;</span>,<span class="st">&quot;href&quot;</span>))[<span class="dv">1</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>depth_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(final_dt), <span class="fu">c</span>(<span class="st">&quot;depth&quot;</span>,<span class="st">&quot;Depth&quot;</span>,<span class="st">&quot;level&quot;</span>,<span class="st">&quot;crawl_depth&quot;</span>))[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(url_col))   <span class="fu">stop</span>(<span class="st">&quot;final_dt must have a URL column.&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(depth_col)) <span class="fu">stop</span>(<span class="st">&quot;final_dt must have a crawl depth column.&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>depth2_urls <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">na.omit</span>(final_dt[<span class="fu">get</span>(depth_col) <span class="sc">==</span> <span class="dv">2</span>][[url_col]]))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Scraping %d depth-2 URLs …&quot;</span>, <span class="fu">length</span>(depth2_urls)))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute scraping (polite delays handled in scrape_many/scrape_one)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>depth2_wide <span class="ot">&lt;-</span> <span class="fu">scrape_many</span>(depth2_urls)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   |                                                               |                                                       |   0%  |                                                               |                                                       |   1%  |                                                               |=                                                      |   1%  |                                                               |=                                                      |   2%  |                                                               |==                                                     |   3%  |                                                               |==                                                     |   4%  |                                                               |===                                                    |   5%  |                                                               |===                                                    |   6%  |                                                               |====                                                   |   7%  |                                                               |====                                                   |   8%  |                                                               |=====                                                  |   8%  |                                                               |=====                                                  |   9%  |                                                               |=====                                                  |  10%  |                                                               |======                                                 |  10%  |                                                               |======                                                 |  11%  |                                                               |======                                                 |  12%  |                                                               |=======                                                |  12%  |                                                               |=======                                                |  13%  |                                                               |========                                               |  14%  |                                                               |========                                               |  15%  |                                                               |=========                                              |  16%  |                                                               |=========                                              |  17%  |                                                               |==========                                             |  18%  |                                                               |==========                                             |  19%  |                                                               |===========                                            |  19%  |                                                               |===========                                            |  20%  |                                                               |===========                                            |  21%  |                                                               |============                                           |  21%  |                                                               |============                                           |  22%  |                                                               |=============                                          |  23%  |                                                               |=============                                          |  24%  |                                                               |==============                                         |  25%  |                                                               |==============                                         |  26%  |                                                               |===============                                        |  27%  |                                                               |===============                                        |  28%  |                                                               |================                                       |  28%  |                                                               |================                                       |  29%  |                                                               |================                                       |  30%  |                                                               |=================                                      |  30%  |                                                               |=================                                      |  31%  |                                                               |=================                                      |  32%  |                                                               |==================                                     |  32%  |                                                               |==================                                     |  33%  |                                                               |===================                                    |  34%  |                                                               |===================                                    |  35%  |                                                               |====================                                   |  36%  |                                                               |====================                                   |  37%  |                                                               |=====================                                  |  38%  |                                                               |=====================                                  |  39%  |                                                               |======================                                 |  39%  |                                                               |======================                                 |  40%  |                                                               |======================                                 |  41%  |                                                               |=======================                                |  41%  |                                                               |=======================                                |  42%  |                                                               |========================                               |  43%  |                                                               |========================                               |  44%  |                                                               |=========================                              |  45%  |                                                               |=========================                              |  46%  |                                                               |==========================                             |  47%  |                                                               |==========================                             |  48%  |                                                               |===========================                            |  48%  |                                                               |===========================                            |  49%  |                                                               |===========================                            |  50%  |                                                               |============================                           |  50%  |                                                               |============================                           |  51%  |                                                               |============================                           |  52%  |                                                               |=============================                          |  52%  |                                                               |=============================                          |  53%  |                                                               |==============================                         |  54%  |                                                               |==============================                         |  55%  |                                                               |===============================                        |  56%  |                                                               |===============================                        |  57%  |                                                               |================================                       |  58%  |                                                               |================================                       |  59%  |                                                               |=================================                      |  59%  |                                                               |=================================                      |  60%  |                                                               |=================================                      |  61%  |                                                               |==================================                     |  61%  |                                                               |==================================                     |  62%  |                                                               |===================================                    |  63%  |                                                               |===================================                    |  64%  |                                                               |====================================                   |  65%  |                                                               |====================================                   |  66%  |                                                               |=====================================                  |  67%  |                                                               |=====================================                  |  68%  |                                                               |======================================                 |  68%  |                                                               |======================================                 |  69%  |                                                               |======================================                 |  70%  |                                                               |=======================================                |  70%  |                                                               |=======================================                |  71%  |                                                               |=======================================                |  72%  |                                                               |========================================               |  72%  |                                                               |========================================               |  73%  |                                                               |=========================================              |  74%  |                                                               |=========================================              |  75%  |                                                               |==========================================             |  76%  |                                                               |==========================================             |  77%  |                                                               |===========================================            |  78%  |                                                               |===========================================            |  79%  |                                                               |============================================           |  79%  |                                                               |============================================           |  80%  |                                                               |============================================           |  81%  |                                                               |=============================================          |  81%  |                                                               |=============================================          |  82%  |                                                               |==============================================         |  83%  |                                                               |==============================================         |  84%  |                                                               |===============================================        |  85%  |                                                               |===============================================        |  86%  |                                                               |================================================       |  87%  |                                                               |================================================       |  88%  |                                                               |=================================================      |  88%  |                                                               |=================================================      |  89%  |                                                               |=================================================      |  90%  |                                                               |==================================================     |  90%  |                                                               |==================================================     |  91%  |                                                               |==================================================     |  92%  |                                                               |===================================================    |  92%  |                                                               |===================================================    |  93%  |                                                               |====================================================   |  94%  |                                                               |====================================================   |  95%  |                                                               |=====================================================  |  96%  |                                                               |=====================================================  |  97%  |                                                               |====================================================== |  98%  |                                                               |====================================================== |  99%  |                                                               |=======================================================|  99%  |                                                               |=======================================================| 100%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: write results</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table::fwrite(depth2_wide, &quot;data/depth2_wide.csv&quot;)</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick summary of extracted fields</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>found_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(depth2_wide), <span class="fu">c</span>(<span class="st">&quot;url&quot;</span>,<span class="st">&quot;page_title&quot;</span>,<span class="st">&quot;status&quot;</span>,<span class="st">&quot;fetched_at&quot;</span>,<span class="st">&quot;error&quot;</span>))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Extracted %d distinct field labels.&quot;</span>, <span class="fu">length</span>(found_cols)))</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sort</span>(found_cols))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>depth2_wide</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                              url</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                           &lt;char&gt;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=aalii</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:     https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=ae_S</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:     https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=ae_Z</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:   https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=ahakea</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:  https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=aheahea</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                                                            </span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 141:     https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=ulei</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 142:      https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=ulu</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 143:    https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=uluhe</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 144:    https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=wauke</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 145: https://data.bishopmuseum.org/ethnobotanydb/ethnobotany.php?b=d&amp;ID=wiliwili</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                page_title status</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                    &lt;char&gt;  &lt;int&gt;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                            </span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 141: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 142: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 143: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 144: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 145: Bishop Museum - Ethnobotany Database    200</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               fetched_at  error</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   &lt;POSc&gt; &lt;char&gt;</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1: 2025-08-18 01:07:25   &lt;NA&gt;</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2: 2025-08-18 01:07:25   &lt;NA&gt;</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3: 2025-08-18 01:07:25   &lt;NA&gt;</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4: 2025-08-18 01:07:26   &lt;NA&gt;</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5: 2025-08-18 01:07:26   &lt;NA&gt;</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                           </span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 141: 2025-08-18 01:08:33   &lt;NA&gt;</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 142: 2025-08-18 01:08:34   &lt;NA&gt;</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 143: 2025-08-18 01:08:34   &lt;NA&gt;</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 144: 2025-08-18 01:08:35   &lt;NA&gt;</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 145: 2025-08-18 01:08:35   &lt;NA&gt;</span></span></code></pre></div>

</body>
</html>
